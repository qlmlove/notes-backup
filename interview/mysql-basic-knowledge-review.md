---
title: MySQL基础知识总结
tags: [mysql]
date: 2017-12-18 14:52:22
---
## MySQL数据类型

### 整数类型

TINYINT
SMALLINT
MEDIUMINT
INT
BIGINT

<font color='red'>注:</font>

- 属性:
    UNSIGNED
- 长度:
    可以为整数类型指定宽度,例如:INT(11)、对大多数应用是没有意义的,它不会限制值的合法范围,只会影响显示的字符个数.     

### 实数类型

FLOAT
DOUBLE
DECIMAL

<font color='red'>注:</font>

DECIMAL可以存储比BIGINT还大的整数;可以用于存储精确的小数(小数点后的位数在用到的时候除10的倍数得到)
FLOAT和DOUBLE类型支持使用标准的浮点进行近似计算

### 字符串类型

VARCHAR
CHAR
TEXT
BLOB

<font color='red'>注:</font>

1. VARCHAR类型用于存储可变长字符串,它比定长类型更节省空间
2. VARCHAR使用1或者2个额外字节记录字符串的长度,列长度小于255字节,使用1个字节表示,否则用2个
3. VARCHAR长度,如果存储内容超过指定长度,会被截断
4. CHAR是定长的,根据定义的字符串长度分配足够的空间
5. CHAR会根据需要采用空格进行填充以方便比较
6. CHAR适合存储很短的字符串,或者所有值都接近同一个长度
7. CHAR长度超出指定的长度,会被截断
8. 对于经常变更的数据,CHAR比VARCHAR更好,CHAR不容易产生碎片
9. 对于非常短的列,CHAR比VARCHAR在存储空间上效率更高
10. 只分配真正需要的空间,更长的列会消耗更多的内存
11. 尽量避免使用BLOB/TEXT类型,因为查询会使用临时表,导致严重的性能开销

### 枚举类型

1. 有时可以使用枚举代替常用的字符串类型
2. 把不重复的集合存储成一个预定义的集合
3. 非常紧凑,把列表压缩成一个或两个字节
4. 内部存储的是整数
5. 尽量避免使用数字作为ENUM枚举的常量,易混乱
6. 排序是按照内部存储的整数今次那个排序
7. 枚举表会是表大小大大减小

### 日期时间类型

1. 尽量使用TIMESTAMP,比DATETIME空间效率高
2. 用整数保存时间戳的格式通常不方便处理
3. 如果需要存储微秒,可以使用BIGINT存储

### 列属性

auto_increment
default
not null
zerofill

## MySQL基础操作

### 常见操作
MySQL的连接和关闭:

`mysql -u -p -h -P`

其中-u指定用户名,-p指定密码,-h指定主机,-P指定端口号

其他:

\G      将打印的结果垂直显示
\c      取消当前mysql命令
\q      退出MySQL
\s      显示MySQL的服务器状态
\h      帮助
\d      改变执行符,比如将;改为其他符号

## MySQL存储引擎

### InnoDB引擎
 
1. 默认事务引擎,最重要最广泛的存储引擎,性能非常优秀
2. 数据存储在共享表空间,可以通过配置分开
3. 对主键查询的性能高于其他类型的存储引擎
4. 内部做了很多优化,从磁盘读取数据时自动在内存构建hash索引,插入数据时自动构建插入缓冲区
5. 通过一些机制和工具支持真正的热备份
6. 支持崩溃后的安全恢复
7. 支持行级锁
8. 支持外键

### MyISAM存储引擎

1. 5.1之前,MyISAM是默认的存储引擎
2. 拥有全文索引,压缩,空间函数
3. 不支持事务和行级锁,不支持崩溃后的安全恢复
4. 表存储在两个文件,MYD和MYI中
5. 设计简单,某些场景下性能很好

### 其他引擎

Archive、Blackhole、CSV、Memory

优先选择InnoDB
## MySQL锁机制

### 基础概念

表锁是日常开发中常见的问题,当多个查询同意时刻进行数据修改时,就会产生并发控制的问题

分为共享锁和排它锁,即就是读锁和写锁

### 读锁

共享的,不堵塞,多个用户可以同时读取一个资源,互不干扰

### 写锁

排他的,一个写锁会阻塞其他的写锁和读锁,这样可以只允许一个人进行写入,防止其他用户读取正在写入的资源.

### 锁粒度

表锁,系统性能开销最小,会锁定整张表,MyISAM使用表锁

行锁,最大程度地支持并发处理,但是也带来了最大的锁开销,InnoDB使用行级锁
## MySQL事务处理

### 事务处理

MySQL提供事务处理的表引擎,InnoDB

服务器层不管理事务,由下层的引擎实现,所以同一个事务中,使用多种存储引擎不靠谱

<font color='red'>注:

在非事务的表上执行事务操作MySQL不会发出提醒,也不会报错</font>
## MySQL存储过程

### 存储过程

1. 为以后的使用而保存的一条或多条MySQL语句的集合

2. 存储过程就是有业务逻辑和流程的集合

3. 可以再存储过程中创建表,更新数据,删除等等

### 使用场景

1. 通过把处理封装在容易使用的单元中,简化复杂的操作 

2. 保证数据的一致性

3. 简化对变动的管理


## MySQL触发器

### 触发器

提供给程序员和数据分析员来保证数据完整性的一种方法,它是与表事件相关的特殊的存储过程   

### 使用场景

1. 可通过数据库中的相关表实现级联更改

2. 实时监控某张表中的某个字段的更改而需要作出相应的处理

3. 某些业务编号的生成等

4. 滥用会造成数据库及应用程序的维护困难

## MySQL创建高性能的索引
### MySQL索引的基础和类型

#### 索引的基础

索引类似于书籍的目录,要想找到一本书中某个特定主题,需要先查找书的目录,定位对应的页码

存储引擎使用类似的方法进行数据查询,先去索引当中找到对应的值没然后根据匹配的索引找到对应的数据行

#### 索引对性能的影响

1. 大大减少服务器需要扫描的数据量
2. 帮助服务器避免排序和临时表
3. 将随机I/O变成顺序I/O
4. 大大提高查询速度,降低写的速度,占用磁盘

#### 索引的使用场景

1. 对于非常小的表,大部分情况下全表扫描效率更高
2. 中到大型表,索引非常有效
3. 特大型表,建立和使用索引的代价将随之增长,可以使用分区技术来解决

#### 索引的类型

索引有很多种类型,都是实现在存储引擎层的

1. 普通索引:最基本的索引,没有任何约束限制
2. 唯一索引:与普通索引类似,但是具有唯一性的约束
3. 主键索引:特殊的唯一索引,不允许有空值
4. 一个表只能有一个主键索引可以有多个唯一索引
5. 主键索引一定是唯一索引,唯一索引不是主键索引
6. 主键可以与外键构成参照完整性约束,防止数据不一致
7. 组合索引:将多个列组合在一起创建索引,可以覆盖多个列
8. 外键索引:只有InnoDB类型的表才可以使用外键索引,保证数据的一致性、完整性和实现级联操作
9. 全文索引:MySQL自带的全文索引只能用于MyISAM,并且只能对英文进行全文检索

### MySQL索引的创建原则

### MySQL索引的注意事项